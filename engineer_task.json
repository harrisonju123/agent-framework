{
  "id": "impl-spec-routing-1739585400",
  "type": "implementation",
  "status": "pending",
  "priority": 1,
  "created_by": "architect",
  "assigned_to": "engineer",
  "created_at": "2026-02-15T00:00:00+00:00",
  "title": "Implement specialization-based model routing",
  "description": "Extend ModelSelector to accept specialization profile as input. Backend/infra tasks with high file count → premium model. Frontend/docs tasks → default model. Combine with existing retry escalation.\n\nImplementation Plan: See IMPLEMENTATION_PLAN.md in workspace root.\n\nKey Changes:\n1. ModelSelector.select() - Add optional specialization_profile and file_count parameters\n2. LLMRequest - Add context field for metadata\n3. Agent - Pass specialization profile and file count in request context\n4. Backends (claude_cli_backend.py, litellm_backend.py) - Extract and forward context\n5. Tests - Add unit tests for specialization routing\n\nRouting Logic:\n- Backend/infrastructure + file_count > 10 → premium model\n- Frontend/docs → default model (no escalation)\n- Retry escalation (>=3) always wins\n- Backward compatible with existing behavior",
  "depends_on": [],
  "blocks": [],
  "acceptance_criteria": [
    "ModelSelector accepts optional specialization_profile parameter",
    "Backend/infrastructure tasks with high file count use premium model",
    "Frontend/docs tasks use default model",
    "Existing retry escalation logic preserved",
    "All existing tests pass",
    "New tests cover specialization-based routing"
  ],
  "deliverables": [],
  "notes": [],
  "context": {
    "workflow": "default",
    "github_repo": "harrisonju123/agent-framework",
    "repository_name": "Agent Framework",
    "jira_available": true,
    "jira_project": "AF",
    "jira_ticket": "AF-XXX (to be created)",
    "implementation_plan": "IMPLEMENTATION_PLAN.md",
    "estimated_lines": 140,
    "estimated_files": 6,
    "source_task_id": "chain-planning-s6--architect-pr",
    "source_agent": "architect"
  },
  "retry_count": 0,
  "last_failed_at": null,
  "started_at": null,
  "started_by": null,
  "completed_at": null,
  "completed_by": null,
  "failed_at": null,
  "failed_by": null,
  "failed_task_id": null,
  "needs_human_review": false,
  "checkpoint_reached": null,
  "checkpoint_message": null,
  "approved_at": null,
  "approved_by": null,
  "estimated_effort": "3 story points",
  "result_summary": null,
  "last_error": null,
  "optimization_override": null,
  "optimization_override_reason": null,
  "plan": {
    "objectives": [
      "Extend ModelSelector with specialization-based routing",
      "Enable smart model selection based on task domain (backend/frontend/infrastructure)"
    ],
    "approach": [
      "Add optional specialization_profile and file_count parameters to ModelSelector.select()",
      "Add context field to LLMRequest dataclass for metadata passing",
      "Update agent.py to extract file count from task.plan and pass specialization in request context",
      "Update both backends (claude_cli, litellm) to extract context and forward to model selector",
      "Implement routing logic: backend/infra + high file count → premium, frontend → default",
      "Add comprehensive unit tests for new routing behavior",
      "Verify backward compatibility (no profile provided)"
    ],
    "risks": [
      "Breaking change to ModelSelector.select() - mitigated by optional parameters with defaults",
      "Specialization profile import cycle - use TYPE_CHECKING or accept profile ID",
      "Over-aggressive premium model usage - start conservative with threshold validation",
      "Missing specialization profile - gracefully handle None, fall back to existing logic"
    ],
    "success_criteria": [
      "Backend/infrastructure tasks with >10 files use premium model",
      "Frontend tasks use default model regardless of file count",
      "Retry escalation (>=3) always overrides specialization routing",
      "All existing tests pass without modification",
      "New tests verify specialization routing with >=80% coverage",
      "Backward compatible: calls without specialization profile work unchanged"
    ],
    "files_to_modify": [
      "src/agent_framework/llm/model_selector.py",
      "src/agent_framework/llm/base.py",
      "src/agent_framework/core/agent.py",
      "src/agent_framework/llm/claude_cli_backend.py",
      "src/agent_framework/llm/litellm_backend.py",
      "tests/unit/test_model_selector.py"
    ]
  },
  "replan_history": [],
  "escalation_report": null,
  "retry_attempts": []
}
